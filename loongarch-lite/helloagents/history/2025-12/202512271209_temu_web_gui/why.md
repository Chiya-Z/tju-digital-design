# 变更提案: TEMU Web 图形界面（仿 Venus）

## 需求背景
当前 TEMU 通过命令行交互（readline）完成运行与调试。为了降低使用门槛并提升教学/实验效率，需要提供一个本地浏览器可访问的图形界面，集中展示寄存器/内存/控制台输出，并提供 Run/Step/Reset/Stop、表达式求值、内存扫描、监视点管理、trace 生成与下载等能力。

## 产品分析

### 目标用户与场景
- **用户群体:** 课程实验学生与助教
- **使用场景:** 本地运行 TEMU，加载测试程序，单步执行并观察寄存器/内存变化，定位错误
- **核心痛点:** 纯 CLI 交互不直观，状态信息分散，操作成本高

### 价值主张与成功指标
- **价值主张:** 用浏览器界面一站式完成“加载-运行-单步-观察-定位-导出”
- **成功指标:**
  - 能完成基础调试闭环：加载程序 → 单步/运行 → 查看寄存器/内存 → 设监视点 → 暂停 → 导出 trace
  - 操作响应稳定，状态展示一致（PC/寄存器/内存/控制台）

### 人文关怀
界面设计应清晰、可达性良好（键盘操作与可读性），避免复杂配置；不收集任何用户隐私数据，所有数据仅在本机生成与存储。

## 变更内容
1. 在 TEMU 内新增 HTTP 服务模块，提供 JSON API 与静态 Web UI（本地浏览器访问）。
2. 复用现有执行/表达式/监视点/trace 能力，提供 Run/Step/Stop/Reset、寄存器与内存读取、`p/x/w/d` 等功能入口。
3. 提供“从编辑器重新汇编”能力：调用本地 `loongarch32r-linux-gnusf-*` 工具链生成 `inst.bin/data.bin` 并重载执行。

## 影响范围
- **模块:** TEMU（`temu/src/monitor`、新增 `temu/src/web`、新增 `temu/webui`）、loongarch_sc（复用工具链假设）
- **文件:** 新增/修改若干 C 源码、头文件与静态资源
- **API:** 新增本地 HTTP JSON API
- **数据:** 新增 trace 输出文件与可下载接口（复用现有 trace 文件）

## 核心场景

### 需求: Web GUI 运行与单步
**模块:** TEMU
在浏览器中加载程序并执行 Run/Step/Stop/Reset，实时查看 PC 与寄存器变化。

#### 场景: 单步调试
在 UI 点击 Step 或输入步数 N，执行 N 条指令后暂停，寄存器/PC/控制台刷新。

### 需求: 表达式求值与内存查看
**模块:** TEMU
在 UI 输入表达式（支持寄存器/算术/逻辑/解引用）并展示结果；支持从表达式地址起连续查看内存。

#### 场景: 内存扫描
在 UI 输入 `x N EXPR` 等价操作，从地址 EXPR 开始打印 N 个字。

### 需求: 监视点
**模块:** TEMU
在 UI 创建/删除监视点，表达式值变化时自动暂停并显示变化前后值。

#### 场景: Watchpoint 暂停
运行中监视点触发，UI 显示触发信息与当前状态。

### 需求: 重新汇编与重载
**模块:** TEMU
在 UI 编辑汇编源码，点击“重新汇编”调用本机工具链生成 `inst.bin/data.bin`，并重启仿真器状态。

#### 场景: Editor → Assemble → Run
编辑 → 重新汇编成功 → 重置并运行 → 生成 trace 并下载。

## 风险评估
- **风险:** 引入 HTTP 服务与静态资源可能增加构建复杂度与平台差异
- **缓解:** 优先采用单文件/最少依赖实现（纯 C + POSIX socket），UI 使用无构建链的静态 HTML/JS；提供明确的端口与路径约定
- **风险:** 工具链调用失败导致“重新汇编”不可用
- **缓解:** 对外暴露清晰错误信息；仍支持上传/选择已存在的 `inst.bin/data.bin`

